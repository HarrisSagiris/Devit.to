<!DOCTYPE html>
<html>
<head>
  <title>Rverto - Your Feed</title>
  <link rel="stylesheet" href="/css/style.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<style>
    body {
        background-color: #0f0f0f;
        color: #e8e8e8;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
        line-height: 1.6;
    }
    
    header {
        background-color: #1a1a1a;
        padding: 15px 0;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        position: sticky;
        top: 0;
        z-index: 100;
    }
    
    header p, header a {
        color: #e8e8e8;
        text-decoration: none;
        margin: 0 10px;
        font-weight: 500;
        transition: all 0.2s ease;
    }
    
    header a:hover {
        color: #ff6b4a;
        transform: translateY(-2px);
    }
    
    h2 {
        color: #ff6b4a;
        text-align: center;
        margin: 30px 0;
        font-size: 2.2em;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    #new-post-form {
        display: flex;
        flex-direction: column;
        align-items: center;
        background: linear-gradient(145deg, #2a2a2a, #1f1f1f);
        padding: 25px;
        border-radius: 15px;
        margin: 30px auto;
        width: 85%;
        max-width: 800px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }
    
    #new-post-form input, #new-post-form textarea, #new-post-form select, #new-post-form button {
        width: 100%;
        margin: 12px 0;
        padding: 12px 15px;
        border-radius: 8px;
        border: 2px solid #333;
        background-color: #1a1a1a;
        color: #e8e8e8;
        font-size: 1rem;
        transition: all 0.3s ease;
    }
    
    #new-post-form input:focus, #new-post-form textarea:focus, #new-post-form select:focus {
        border-color: #ff6b4a;
        outline: none;
        box-shadow: 0 0 10px rgba(255, 107, 74, 0.3);
    }
    
    #new-post-form button {
        background: linear-gradient(135deg, #ff6b4a, #ff4500);
        color: white;
        cursor: pointer;
        font-weight: bold;
        border: none;
        transform: translateY(0);
        transition: all 0.3s ease;
    }
    
    #new-post-form button:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(255, 107, 74, 0.4);
    }
    
    .post {
        background: linear-gradient(145deg, #2a2a2a, #1f1f1f);
        margin: 20px auto;
        padding: 25px;
        border-radius: 15px;
        width: 85%;
        max-width: 800px;
        color: #e8e8e8;
        position: relative;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s ease;
    }
    
    .post:hover {
        transform: translateY(-5px);
    }
    
    .post h3 {
        color: #ff6b4a;
        font-size: 1.4em;
        margin-bottom: 15px;
        border-bottom: 2px solid #333;
        padding-bottom: 10px;
    }
    
    .post p {
        margin: 15px 0;
        line-height: 1.7;
    }
    
    .upvote, .downvote {
        background: linear-gradient(135deg, #2a2a2a, #222);
        color: #ff6b4a;
        border: none;
        padding: 8px 15px;
        border-radius: 8px;
        margin: 8px 8px 8px 0;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .upvote:hover, .downvote:hover {
        background: linear-gradient(135deg, #ff6b4a, #ff4500);
        color: #fff;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 107, 74, 0.3);
    }
    
    .comment-form {
        display: flex;
        align-items: center;
        margin-top: 15px;
        gap: 10px;
    }
    
    .comment-form input {
        flex: 1;
        padding: 12px;
        background-color: #1a1a1a;
        border: 2px solid #333;
        border-radius: 8px;
        color: #e8e8e8;
        transition: all 0.3s ease;
    }
    
    .comment-form input:focus {
        border-color: #ff6b4a;
        outline: none;
        box-shadow: 0 0 10px rgba(255, 107, 74, 0.3);
    }
    
    .comment-form button {
        background: linear-gradient(135deg, #2a2a2a, #222);
        color: #ff6b4a;
        border: none;
        padding: 12px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .comment-form button:hover {
        background: linear-gradient(135deg, #ff6b4a, #ff4500);
        color: #fff;
        transform: translateY(-2px);
    }
    
    .comments {
        margin-top: 20px;
    }
    
    .comment {
        background: linear-gradient(145deg, #2a2a2a, #222);
        padding: 15px;
        border-radius: 10px;
        margin-top: 10px;
        color: #e8e8e8;
        border-left: 3px solid #ff6b4a;
        transition: transform 0.3s ease;
    }
    
    .comment:hover {
        transform: translateX(5px);
    }
    
    .comment strong {
        color: #ff6b4a;
        font-weight: 600;
    }
    
    </style>

<body>
  <h4>version 1.0(beta)</h4>
  <h2>Welcome to Rverto: The Number 1 Reviewing Platform Worldwide</h2>
  <h2>Login or register to post/like and comment!</h2>
  

  <header>
    <% if (user) { %>
      <p>Welcome, <%= user.username %> | <a href="/logout">Logout</a> | <a href="/my-posts">My Posts</a></p>
      <form id="new-post-form">
        <input type="text" name="title" placeholder="Title" required><br>
        <select name="category">
          <option value="General post">General</option>
          <option value="Movies">Movies</option>
          <option value="Books">Books</option>
          <option value="Games">Games</option>
          <option value="Songs">Songs</option>
          <option value="Programming">Programming</option>
          <option value="Physical product">Physical product</option>
          <option value="Netflix movies-movies">Movies</option>
        </select><br>
        <textarea name="content" placeholder="Your review" required></textarea><br>
        <button type="submit">Post</button>
      </form>
      
    <% } else { %>
      <a href="/login">Login</a> | <a href="/register">Register</a> 
    <% } %>
    
  </header>

  <section>
    <h2>Feed</h2>
    <div id="feed">
      <% posts.forEach(post => { %>
        <div class="post" id="post-<%= post._id %>">
          <h3><%= post.title %> - <%= post.category %></h3>
          <p><strong>by <%= post.username %></strong></p>
          <p><%= post.content %></p>
          <p>Upvotes: <span class="upvote-count"><%= post.upvotes %></span> | Downvotes: <span class="downvote-count"><%= post.downvotes %></span></p>
          <% if (user) { %>
            <button class="upvote" data-id="<%= post._id %>">Upvote</button>
            <button class="downvote" data-id="<%= post._id %>">Downvote</button>
            <form class="comment-form" data-id="<%= post._id %>">
              <input type="text" name="content" placeholder="Add a comment" required>
              <button type="submit">Comment</button>
              <meta http-equiv="refresh" content="(1)"> <! here i want to impliment auto refresh after the comment submission...>
            </form>
          <% } %>

          <!-- Comments Section -->
          <h4>Replies :</h4>
          <div class="comments" id="comments-<%= post._id %>">
            <% post.comments.forEach(comment => { %>
              <div class="comment">
                <strong><%= comment.username %>:</strong> <%= comment.content %>
              </div>
            <% }) %>
          </div>
        </div>
        <hr>
      <% }) %>
    </div>
    <h5>Copywrited by harris sagiris 2024 RVERTOÂ©</h5>
  </section>

  <script>
    $(document).ready(function() {
      // Handle new post submission
      $('#new-post-form').on('submit', function(event) {
        event.preventDefault();
        $.ajax({
          url: '/post',
          method: 'POST',
          data: $(this).serialize(),
          success: function(response) {
            $('#feed').prepend(response); // Add the new post to the top of the feed
            $('#new-post-form')[0].reset(); // Clear the form
          }
        });
      });

      // Handle upvote and downvote
      $(document).on('click', '.upvote, .downvote', function() {
        const postId = $(this).data('id');
        const isUpvote = $(this).hasClass('upvote');
        const voteType = isUpvote ? 'upvote' : 'downvote';

        $.ajax({
          url: `/post/${postId}/${voteType}`,
          method: 'POST',
          success: function(response) {
            $(`#post-${postId} .upvote-count`).text(response.upvotes);
            $(`#post-${postId} .downvote-count`).text(response.downvotes);
          }
        });
      });
    });
  </script>
  <script>
    $(document).ready(function() {
      $('#search-bar').on('input', function() {
        const query = $(this).val();
  
        $.ajax({
          url: '/search',
          method: 'GET',
          data: { q: query },
          success: function(response) {
            $('#feed').html(response); // Update the feed with search results
          },
          error: function() {
            alert('Error retrieving search results');
          }
        });
      });
    });
  </script>
  
</body>
</html>
